(function(a){a(document).ready(function(){var g="accrhcdehngpugpudhpcwtykbfdykarp";var f=window[g+"UserPermissionsWidgetData"];var e=neyjfbxruwddgfeedwacfbggzbxkwfxhJQueryJsGridData;var i=a("#"+g+"-user-permissions-widget");var b=i.find('.-grid[data-toggle~="jquery-jsgrid"]');if(!i.length||!b.length){return}var d=a.parseJSON(i.find(".-user-permissions").val());var h=a.parseJSON(i.find(".-restriction-titles-by-id").val());var c=[{ID:null,title:""}];a.each(h,function(j,k){c.push({ID:j,title:k})});b.jsGrid(a.extend({},e.defaultOptions,{data:d,noDataContent:f.i18n.noDataContent,sorting:false,paging:false,onRefreshed:function(){b.find(".jsgrid-grid-body > table > tbody").sortable({placeholder:"ui-state-highlight"})},fields:[{type:"number",align:"center",name:"ID",title:f.i18n.idTitle,visible:false,},{type:"number",align:"center",name:"user_id",title:f.i18n.userIdTitle,visible:false,},{type:"number",align:"center",name:"order_id",title:f.i18n.orderIdTitle,visible:false,},{type:"number",align:"center",name:"product_id",title:f.i18n.productIdTitle,visible:false,},{width:"30%",type:"select",align:"center",name:"restriction_id",title:f.i18n.restrictionIdTitle,visible:true,editing:true,inserting:true,valueField:"ID",valueType:"number",textField:"title",items:c,validate:{validator:function(k,j){return typeof k==="number"&&k>0},message:function(k,j){return"• "+f.i18n.restrictionAccessRequired}},itemTemplate:function(o,n){var p="";var l=true,k=false,j=false,q=false;var m=parseInt(moment.utc().format("X"));if(!n.is_enabled){k=true;l=false}if(n.access_time){if(n.access_time>m){j=true;l=false}}if(n.expire_time){if(n.expire_time<=m){q=true;l=false}}if(o&&typeof h[o]==="string"){if(l){p+='<span class="dashicons dashicons-unlock" style="color:#49a642;" title="'+_.escape(f.i18n.restrictionIdStatusIsAllowed)+'" data-toggle="jquery-ui-tooltip"></span>'}else{if(k){p+='<span class="si si-octi-lock" style="color:#666;" title="'+_.escape(f.i18n.restrictionIdStatusIsDisabled)+'" data-toggle="jquery-ui-tooltip"></span>'}else{if(j){p+='<span class="si si-calendar-check-o" style="color:#666;" title="'+_.escape(f.i18n.restrictionIdStatusIsScheduled)+'" data-toggle="jquery-ui-tooltip"></span>'}else{if(q){p+='<span class="si si-calendar-times-o" style="color:#666;" title="'+_.escape(f.i18n.restrictionIdStatusIsExpired)+'" data-toggle="jquery-ui-tooltip"></span>'}}}}p+=" <strong>"+_.escape(h[o])+"</strong>";if(n.order_id){p+=" <em><small>| "+_.escape(f.i18n.via+" "+f.i18n.orderIdTitle)+' <a href="'+_.escape(f["orderViewUrl="]+encodeURIComponent(n.order_id))+'">#'+_.escape(n.order_id)+"</a></small></em>"}}return p}},{type:"number",align:"center",name:"original_restriction_id",title:f.i18n.original+" "+f.i18n.restrictionIdTitle,visible:false,},{width:"25%",type:"dateTime",align:"center",name:"access_time",title:f.i18n.accessTimeTitle,datePlaceholderText:f.i18n.accessDatePlaceholder,timePlaceholderText:f.i18n.accessTimePlaceholder,emptyDateTimeItemText:f.i18n.emptyAccessDateTime,noTimeEquals:"startOfDay",visible:true,editing:true,inserting:true,validate:{validator:function(k,j){return !k||!j.expire_time||k<j.expire_time},message:function(k,j){return"• "+f.i18n.accessTimeLtExpireTime}},},{type:"number",align:"center",name:"original_access_time",title:f.i18n.original+" "+f.i18n.accessTimeTitle,visible:false,},{width:"25%",type:"dateTime",align:"center",name:"expire_time",title:f.i18n.expireTimeTitle,datePlaceholderText:f.i18n.expireDatePlaceholder,timePlaceholderText:f.i18n.expireTimePlaceholder,emptyDateTimeItemText:f.i18n.emptyExpireDateTime,noTimeEquals:"endOfDay",visible:true,editing:true,inserting:true},{type:"text",align:"center",name:"expire_time_via",title:f.i18n.expireTimeViaTitle,visible:false,},{type:"number",align:"center",name:"expire_time_via_id",title:f.i18n.expireTimeViaIdTitle,visible:false,},{type:"number",align:"center",name:"original_expire_time",title:f.i18n.original+" "+f.i18n.expireTimeTitle,visible:false,},{width:"10%",type:"checkbox",align:"center",name:"is_enabled",title:f.i18n.isEnabledTitle,visible:true,editing:true,inserting:true,_createCheckbox:function(){return a('<input type="checkbox" checked />')}},{width:"10%",type:"number",align:"center",name:"is_trashed",title:f.i18n.isTrashedTitle,visible:false,},{type:"number",align:"center",name:"display_order",title:f.i18n.displayOrderTitle,visible:false,},{type:"number",align:"center",name:"insertion_time",title:f.i18n.insertionTimeTitle,visible:false,},{type:"number",align:"center",name:"last_update_time",title:f.i18n.lastUpdateTimeTitle,visible:false,},a.extend({},e.controlDefaultOptions,{})]}));i.tooltip({position:{my:"right center",at:"left-10 center",using:function(j,k){a(this).css(j).addClass(k.vertical+" "+k.horizontal)}},tooltipClass:g+"-tooltip",items:'[data-toggle~="jquery-ui-tooltip"]'});i.closest("form").on("submit",function(k){var j=[];if(b.find(".jsgrid-grid-header > table > tbody > tr.jsgrid-insert-row").filter(":visible").find("> td:first-child select").val()){alert(f.i18n.notReadyToSave+"\n• "+f.i18n.stillInserting);k.preventDefault(),k.stopImmediatePropagation();return false}if(b.find(".jsgrid-grid-body > table > tbody > tr.jsgrid-edit-row").length){alert(f.i18n.notReadyToSave+"\n• "+f.i18n.stillEditing);k.preventDefault(),k.stopImmediatePropagation();return false}b.find(".jsgrid-grid-body > table > tbody > tr:not(.jsgrid-nodata-row)").each(function(l){j.push(a.extend(a(this).data("JSGridItem"),{display_order:l}))});i.find(".-user-permissions").val(JSON.stringify(j))})})})(jQuery);