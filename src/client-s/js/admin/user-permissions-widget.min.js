(function(a){a(document).ready(function(){var e="accrhcdehngpugpudhpcwtykbfdykarp";var d=window[e+"UserPermissionsWidgetData"];var g=neyjfbxruwddgfeedwacfbggzbxkwfxhJQueryJsGridData;var b=a("#"+e+"-user-permissions-widget");var k=b.find('.-grid[data-toggle~="jquery-jsgrid"]');if(!b.length||!k.length){return}var c=a.parseJSON(b.find(".-user-permissions").val());var h=a.parseJSON(b.find(".-restriction-titles-by-id").val());var f=a.parseJSON(b.find(".-user-permission-statuses").val());var j=[{ID:null,title:""}];a.each(h,function(l,m){j.push({ID:l,title:m})});var i=[{status:null,title:""}];a.each(f,function(l,m){i.push({status:l,title:m})});k.jsGrid(a.extend({},g.defaultOptions,{data:c,noDataContent:d.i18n.noDataContent,sorting:false,paging:false,onRefreshed:function(){k.find(".jsgrid-grid-body > table > tbody").sortable({placeholder:"ui-state-highlight"})},fields:[{type:"number",align:"center",name:"ID",title:d.i18n.idTitle,visible:false,},{type:"number",align:"center",name:"user_id",title:d.i18n.userIdTitle,visible:false,},{type:"number",align:"center",name:"order_id",title:d.i18n.orderIdTitle,visible:false,},{type:"number",align:"center",name:"subscription_id",title:d.i18n.subscriptionIdTitle,visible:false,},{type:"number",align:"center",name:"product_id",title:d.i18n.productIdTitle,visible:false,},{width:"30%",type:"select",align:"center",name:"restriction_id",title:d.i18n.restrictionIdTitle,visible:true,editing:true,inserting:true,valueField:"ID",valueType:"number",textField:"title",items:j,validate:{validator:function(m,l){return typeof m==="number"&&m>0},message:function(m,l){return"• "+d.i18n.restrictionAccessRequired}},itemTemplate:function(q,p){var r="";var n=true,m=false,l=false,s=false;var o=parseInt(moment.utc().format("X"));if(p.is_trashed||p.status!=="active"){n=false;m=true}if(p.access_time&&p.access_time>o){n=false;l=true}if(p.expire_time&&p.expire_time<=o){n=false;s=true}if(q&&typeof h[q]==="string"){if(n){r+='<span class="dashicons dashicons-unlock" style="color:#49a642;" title="'+_.escape(d.i18n.restrictionIdStatusIsAllowed)+'" data-toggle="jquery-ui-tooltip"></span>'}else{if(m){r+='<span class="si si-octi-lock" style="color:#666;" title="'+_.escape(d.i18n.restrictionIdStatusIsInactive+": "+(typeof f[p.status]==="string"?f[p.status]:p.status))+'" data-toggle="jquery-ui-tooltip"></span>'}else{if(l){r+='<span class="si si-calendar-check-o" style="color:#666;" title="'+_.escape(d.i18n.restrictionIdStatusIsScheduled)+'" data-toggle="jquery-ui-tooltip"></span>'}else{if(s){r+='<span class="si si-calendar-times-o" style="color:#666;" title="'+_.escape(d.i18n.restrictionIdStatusIsExpired)+'" data-toggle="jquery-ui-tooltip"></span>'}}}}r+=" <strong>"+_.escape(h[q])+"</strong>";if(p.order_id){if(d.current_user.can_edit_shop_orders){r+=" <em><small>| "+_.escape(d.i18n.via+" "+d.i18n.orderIdTitle)+' <a href="'+_.escape(d["orderViewUrl="]+encodeURIComponent(p.order_id))+'">#'+_.escape(p.order_id)+"</a></small></em>"}else{r+=" <em><small>| "+_.escape(d.i18n.via+" "+d.i18n.orderIdTitle)+" #"+_.escape(p.order_id)+"</small></em>"}}else{if(p.subscription_id){if(d.current_user.can_edit_shop_subscriptions){r+=" <em><small>| "+_.escape(d.i18n.via+" "+d.i18n.subscriptionIdTitle)+' <a href="'+_.escape(d["subscriptionViewUrl="]+encodeURIComponent(p.subscription_id))+'">#'+_.escape(p.subscription_id)+"</a></small></em>"}else{r+=" <em><small>| "+_.escape(d.i18n.via+" "+d.i18n.subscriptionIdTitle)+" #"+_.escape(p.subscription_id)+"</small></em>"}}}}return r}},{width:"22.5%",type:"dateTime",align:"center",name:"access_time",title:d.i18n.accessTimeTitle,datePlaceholderText:d.i18n.accessDatePlaceholder,timePlaceholderText:d.i18n.accessTimePlaceholder,emptyDateTimeItemText:d.i18n.emptyAccessDateTime,noTimeEquals:"startOfDay",visible:true,editing:true,inserting:true,validate:{validator:function(m,l){return !m||!l.expire_time||m<l.expire_time},message:function(m,l){return"• "+d.i18n.accessTimeLtExpireTime}},},{width:"22.5%",type:"dateTime",align:"center",name:"expire_time",title:d.i18n.expireTimeTitle,datePlaceholderText:d.i18n.expireDatePlaceholder,timePlaceholderText:d.i18n.expireTimePlaceholder,emptyDateTimeItemText:d.i18n.emptyExpireDateTime,noTimeEquals:"endOfDay",visible:true,editing:true,inserting:true,itemTemplate:function(m,l){if(l.subscription_id&&!parseInt(timestamp)){return"<em>"+_.escape(d.i18n.emptyExpireDateTimeSubscription)+"</em>"}else{return this._timestampFormat(m,this.subType,true)}}},{width:"15%",type:"select",align:"center",name:"status",title:d.i18n.statusTitle,visible:true,editing:true,inserting:true,valueField:"status",valueType:"string",textField:"title",items:i,validate:{validator:function(m,l){return typeof m==="string"&&m&&m!=="0"},message:function(m,l){return"• "+d.i18n.restrictionStatusRequired}}},{type:"number",align:"center",name:"is_trashed",title:d.i18n.isTrashedTitle,visible:false,},{type:"number",align:"center",name:"display_order",title:d.i18n.displayOrderTitle,visible:false,},{type:"number",align:"center",name:"insertion_time",title:d.i18n.insertionTimeTitle,visible:false,},{type:"number",align:"center",name:"last_update_time",title:d.i18n.lastUpdateTimeTitle,visible:false,},a.extend({},g.controlDefaultOptions,{})]}));b.tooltip({position:{my:"right center",at:"left-10 center",using:function(l,m){a(this).css(l).addClass(m.vertical+" "+m.horizontal)}},tooltipClass:e+"-tooltip",items:'[data-toggle~="jquery-ui-tooltip"]'});b.closest("form").on("submit",function(m){var l=[];if(k.find(".jsgrid-grid-header > table > tbody > tr.jsgrid-insert-row").filter(":visible").find("> td:first-child select").val()){alert(d.i18n.notReadyToSave+"\n• "+d.i18n.stillInserting);m.preventDefault(),m.stopImmediatePropagation();return false}if(k.find(".jsgrid-grid-body > table > tbody > tr.jsgrid-edit-row").length){alert(d.i18n.notReadyToSave+"\n• "+d.i18n.stillEditing);m.preventDefault(),m.stopImmediatePropagation();return false}k.find(".jsgrid-grid-body > table > tbody > tr:not(.jsgrid-nodata-row)").each(function(n){l.push(a.extend(a(this).data("JSGridItem"),{display_order:n}))});b.find(".-user-permissions").val(JSON.stringify(l))})})})(jQuery);