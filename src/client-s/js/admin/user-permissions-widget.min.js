(function(a){a(document).ready(function(){var f="accrhcdehngpugpudhpcwtykbfdykarp";var e=window[f+"UserPermissionsWidgetData"];var h=neyjfbxruwddgfeedwacfbggzbxkwfxhJQueryJsGridData;var b=a("#"+f+"-user-permissions-widget");var k=b.find('.-grid[data-toggle~="jquery-jsgrid"]');if(!b.length||!k.length){return}var c=false;var d=a.parseJSON(b.find(".-user-permissions").val());var j=[{ID:0,title:""}];a.each(e.restrictionTitlesById,function(l,m){j.push({ID:l,title:m})});var i=[];a.each(e.userPermissionStatuses,function(l,m){i.push({status:l,title:m})});k.jsGrid(a.extend({},h.defaultOptions,{data:d,noDataContent:e.i18n.noDataContent,insertingByDefault:d.length===0,sorting:false,paging:false,rowClick:function(l){if(this._editingRow){this.updateItem()}this.editItem(a(l.event.target).closest("tr"))},onRefreshed:function(l){if(c){return}c=true;k.find(".jsgrid-grid-body > table > tbody").sortable({placeholder:"ui-state-highlight"})},fields:[{type:"number",align:"center",name:"ID",title:e.i18n.idTitle,visible:false,},{type:"number",align:"center",name:"user_id",title:e.i18n.userIdTitle,visible:false,},{type:"number",align:"center",name:"order_id",title:e.i18n.orderIdTitle,visible:false,},{type:"number",align:"center",name:"subscription_id",title:e.i18n.subscriptionIdTitle,visible:false,},{type:"number",align:"center",name:"product_id",title:e.i18n.productIdTitle,visible:false,},{width:"30%",type:"select",align:"center",name:"restriction_id",title:e.i18n.restrictionIdTitle,visible:true,editing:true,inserting:true,valueField:"ID",valueType:"number",textField:"title",items:j,validate:{validator:function(m,l){return typeof m==="number"&&m>0},message:function(m,l){return"• "+e.i18n.restrictionAccessRequired}},itemTemplate:function(q,p){var r="";var n=true,m=false,l=false,s=false;if(!q||q==="0"){return""}var o=parseInt(moment.utc().format("X"));if(p.is_trashed||p.status!=="active"){n=false;m=true}if(p.access_time&&p.access_time>o){n=false;l=true}if(p.expire_time&&p.expire_time<=o){n=false;s=true}if(n){r+='<span class="dashicons dashicons-unlock" style="color:#49a642;" title="'+_.escape(e.i18n.restrictionIdStatusIsAllowed)+'" data-toggle="jquery-ui-tooltip"></span>'}else{if(m){r+='<span class="si si-octi-lock" style="color:#666;" title="'+_.escape(e.i18n.restrictionIdStatusIsInactive+": "+e.userPermissionStatuses[p.status])+'" data-toggle="jquery-ui-tooltip"></span>'}else{if(l){r+='<span class="si si-calendar-check-o" style="color:#666;" title="'+_.escape(e.i18n.restrictionIdStatusIsScheduled)+'" data-toggle="jquery-ui-tooltip"></span>'}else{if(s){r+='<span class="si si-calendar-times-o" style="color:#666;" title="'+_.escape(e.i18n.restrictionIdStatusIsExpired)+'" data-toggle="jquery-ui-tooltip"></span>'}}}}r+=" <strong>"+_.escape(e.restrictionTitlesById[q])+"</strong>";if(p.order_id){if(e.current_user.can_edit_shop_orders){r+=" <em><small>| "+_.escape(e.i18n.via+" "+e.i18n.orderIdTitle)+' <a href="'+_.escape(e["orderViewUrl="]+encodeURIComponent(p.order_id))+'">#'+_.escape(p.order_id)+"</a></small></em>"}else{r+=" <em><small>| "+_.escape(e.i18n.via+" "+e.i18n.orderIdTitle)+" #"+_.escape(p.order_id)+"</small></em>"}}else{if(p.subscription_id){if(e.current_user.can_edit_shop_subscriptions){r+=" <em><small>| "+_.escape(e.i18n.via+" "+e.i18n.subscriptionIdTitle)+' <a href="'+_.escape(e["subscriptionViewUrl="]+encodeURIComponent(p.subscription_id))+'">#'+_.escape(p.subscription_id)+"</a></small></em>"}else{r+=" <em><small>| "+_.escape(e.i18n.via+" "+e.i18n.subscriptionIdTitle)+" #"+_.escape(p.subscription_id)+"</small></em>"}}}return r}},{width:"22.5%",type:"dateTime",align:"center",name:"access_time",title:e.i18n.accessTimeTitle,datePlaceholderText:e.i18n.accessDatePlaceholder,timePlaceholderText:e.i18n.accessTimePlaceholder,emptyDateTimeItemText:e.i18n.emptyAccessDateTime,noTimeEquals:"startOfDay",visible:true,editing:true,inserting:true,validate:{validator:function(m,l){return typeof m==="number"&&(!m||!l.expire_time||m<l.expire_time)},message:function(m,l){return"• "+e.i18n.accessTimeLtExpireTime}},},{width:"22.5%",type:"dateTime",align:"center",name:"expire_time",title:e.i18n.expireTimeTitle,datePlaceholderText:e.i18n.expireDatePlaceholder,timePlaceholderText:e.i18n.expireTimePlaceholder,emptyDateTimeItemText:e.i18n.emptyExpireDateTime,noTimeEquals:"endOfDay",visible:true,editing:true,inserting:true,itemTemplate:function(m,l){if((l.order_id||l.subscription_id)&&l.expire_directive&&!parseInt(m)){if(typeof e.productPermissionExpireOffsetDirectives[l.expire_directive]==="string"){return"<em>"+_.escape(e.productPermissionExpireOffsetDirectives[l.expire_directive])+"</em>"}else{return"<em>"+_.escape(l.expire_directive)+"</em>"}}else{return this._timestampFormat(m,this.subType,true)}}},{type:"text",align:"center",name:"expire_directive",title:e.i18n.expireDirectiveTitle,visible:false,},{width:"15%",type:"select",align:"center",name:"status",title:e.i18n.statusTitle,visible:true,editing:true,inserting:true,valueField:"status",valueType:"string",textField:"title",items:i,validate:{validator:function(m,l){return typeof m==="string"&&m&&m!=="0"},message:function(m,l){return"• "+e.i18n.restrictionStatusRequired}}},{type:"number",align:"center",name:"is_trashed",title:e.i18n.isTrashedTitle,visible:false,},{type:"number",align:"center",name:"display_order",title:e.i18n.displayOrderTitle,visible:false,},{type:"number",align:"center",name:"insertion_time",title:e.i18n.insertionTimeTitle,visible:false,},{type:"number",align:"center",name:"last_update_time",title:e.i18n.lastUpdateTimeTitle,visible:false,},a.extend({},h.controlDefaultOptions)]}));b.tooltip({position:{my:"right center",at:"left-10 center",using:function(l,m){a(this).css(l).addClass(m.vertical+" "+m.horizontal)}},tooltipClass:f+"-tooltip",items:'[data-toggle~="jquery-ui-tooltip"]'});var g=function(n){var l=[];var m=k.find(".jsgrid-insert-mode-button.jsgrid-mode-on-button").length!==0;var p=k.find(".jsgrid-grid-header > table > tbody > tr.jsgrid-insert-row");var o=p.find("> td:first-child select").val();if(m&&o&&o!=="0"){alert(e.i18n.notReadyToSave+"\n• "+e.i18n.stillInserting);n.preventDefault(),n.stopImmediatePropagation();return false}if(k.find(".jsgrid-grid-body > table > tbody > tr.jsgrid-edit-row").length){k.data("JSGrid").updateItem()}k.find(".jsgrid-grid-body > table > tbody > tr:not(.jsgrid-nodata-row)").each(function(q){l.push(a.extend(a(this).data("JSGridItem"),{display_order:q}))});b.find(".-user-permissions").val(JSON.stringify(l))};b.closest("form").on("submit",g)})})(jQuery);