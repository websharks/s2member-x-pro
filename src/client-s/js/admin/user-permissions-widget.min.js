(function(a){a(document).ready(function(){var f="accrhcdehngpugpudhpcwtykbfdykarp";var e=window[f+"UserPermissionsWidgetData"];var g=neyjfbxruwddgfeedwacfbggzbxkwfxhJQueryJsGridData;var b=a("#"+f+"-user-permissions-widget");var j=b.find('.-grid[data-toggle~="jquery-jsgrid"]');if(!b.length||!j.length){return}var c=false;var d=a.parseJSON(b.find(".-user-permissions").val());var i=[{ID:null,title:""}];a.each(e.restrictionTitlesById,function(k,l){i.push({ID:k,title:l})});var h=[];a.each(e.userPermissionStatuses,function(k,l){h.push({status:k,title:l})});j.jsGrid(a.extend({},g.defaultOptions,{data:d,noDataContent:e.i18n.noDataContent,insertingByDefault:d.length===0,sorting:false,paging:false,onRefreshed:function(k){if(c){return}c=true;j.find(".jsgrid-grid-body > table > tbody").sortable({placeholder:"ui-state-highlight"})},fields:[{type:"number",align:"center",name:"ID",title:e.i18n.idTitle,visible:false,},{type:"number",align:"center",name:"user_id",title:e.i18n.userIdTitle,visible:false,},{type:"number",align:"center",name:"order_id",title:e.i18n.orderIdTitle,visible:false,},{type:"number",align:"center",name:"subscription_id",title:e.i18n.subscriptionIdTitle,visible:false,},{type:"number",align:"center",name:"product_id",title:e.i18n.productIdTitle,visible:false,},{width:"30%",type:"select",align:"center",name:"restriction_id",title:e.i18n.restrictionIdTitle,visible:true,editing:true,inserting:true,valueField:"ID",valueType:"number",textField:"title",items:i,validate:{validator:function(l,k){return typeof l==="number"&&l>0},message:function(l,k){return"• "+e.i18n.restrictionAccessRequired}},itemTemplate:function(p,o){var q="";var m=true,l=false,k=false,r=false;if(!p||p==="0"){return""}var n=parseInt(moment.utc().format("X"));if(o.is_trashed||o.status!=="active"){m=false;l=true}if(o.access_time&&o.access_time>n){m=false;k=true}if(o.expire_time&&o.expire_time<=n){m=false;r=true}if(m){q+='<span class="dashicons dashicons-unlock" style="color:#49a642;" title="'+_.escape(e.i18n.restrictionIdStatusIsAllowed)+'" data-toggle="jquery-ui-tooltip"></span>'}else{if(l){q+='<span class="si si-octi-lock" style="color:#666;" title="'+_.escape(e.i18n.restrictionIdStatusIsInactive+": "+e.userPermissionStatuses[o.status])+'" data-toggle="jquery-ui-tooltip"></span>'}else{if(k){q+='<span class="si si-calendar-check-o" style="color:#666;" title="'+_.escape(e.i18n.restrictionIdStatusIsScheduled)+'" data-toggle="jquery-ui-tooltip"></span>'}else{if(r){q+='<span class="si si-calendar-times-o" style="color:#666;" title="'+_.escape(e.i18n.restrictionIdStatusIsExpired)+'" data-toggle="jquery-ui-tooltip"></span>'}}}}q+=" <strong>"+_.escape(e.restrictionTitlesById[p])+"</strong>";if(o.order_id){if(e.current_user.can_edit_shop_orders){q+=" <em><small>| "+_.escape(e.i18n.via+" "+e.i18n.orderIdTitle)+' <a href="'+_.escape(e["orderViewUrl="]+encodeURIComponent(o.order_id))+'">#'+_.escape(o.order_id)+"</a></small></em>"}else{q+=" <em><small>| "+_.escape(e.i18n.via+" "+e.i18n.orderIdTitle)+" #"+_.escape(o.order_id)+"</small></em>"}}else{if(o.subscription_id){if(e.current_user.can_edit_shop_subscriptions){q+=" <em><small>| "+_.escape(e.i18n.via+" "+e.i18n.subscriptionIdTitle)+' <a href="'+_.escape(e["subscriptionViewUrl="]+encodeURIComponent(o.subscription_id))+'">#'+_.escape(o.subscription_id)+"</a></small></em>"}else{q+=" <em><small>| "+_.escape(e.i18n.via+" "+e.i18n.subscriptionIdTitle)+" #"+_.escape(o.subscription_id)+"</small></em>"}}}return q}},{width:"22.5%",type:"dateTime",align:"center",name:"access_time",title:e.i18n.accessTimeTitle,datePlaceholderText:e.i18n.accessDatePlaceholder,timePlaceholderText:e.i18n.accessTimePlaceholder,emptyDateTimeItemText:e.i18n.emptyAccessDateTime,noTimeEquals:"startOfDay",visible:true,editing:true,inserting:true,validate:{validator:function(l,k){return typeof l==="number"&&(!l||!k.expire_time||l<k.expire_time)},message:function(l,k){return"• "+e.i18n.accessTimeLtExpireTime}},},{width:"22.5%",type:"dateTime",align:"center",name:"expire_time",title:e.i18n.expireTimeTitle,datePlaceholderText:e.i18n.expireDatePlaceholder,timePlaceholderText:e.i18n.expireTimePlaceholder,emptyDateTimeItemText:e.i18n.emptyExpireDateTime,noTimeEquals:"endOfDay",visible:true,editing:true,inserting:true,itemTemplate:function(l,k){if((k.order_id||k.subscription_id)&&k.expires&&!parseInt(l)){return"<em>"+_.escape(e.productPermissionExpireOffsetTimes[k.expires])+"</em>"}else{return this._timestampFormat(l,this.subType,true)}}},{type:"text",align:"center",name:"expires",title:e.i18n.expiresTitle,visible:false,},{width:"15%",type:"select",align:"center",name:"status",title:e.i18n.statusTitle,visible:true,editing:true,inserting:true,valueField:"status",valueType:"string",textField:"title",items:h,validate:{validator:function(l,k){return typeof l==="string"&&l&&l!=="0"},message:function(l,k){return"• "+e.i18n.restrictionStatusRequired}}},{type:"number",align:"center",name:"is_trashed",title:e.i18n.isTrashedTitle,visible:false,},{type:"number",align:"center",name:"display_order",title:e.i18n.displayOrderTitle,visible:false,},{type:"number",align:"center",name:"insertion_time",title:e.i18n.insertionTimeTitle,visible:false,},{type:"number",align:"center",name:"last_update_time",title:e.i18n.lastUpdateTimeTitle,visible:false,},a.extend({},g.controlDefaultOptions)]}));b.tooltip({position:{my:"right center",at:"left-10 center",using:function(k,l){a(this).css(k).addClass(l.vertical+" "+l.horizontal)}},tooltipClass:f+"-tooltip",items:'[data-toggle~="jquery-ui-tooltip"]'});b.closest("form").on("submit",function(l){var k=[];if(j.find(".jsgrid-grid-header > table > tbody > tr.jsgrid-insert-row").filter(":visible").find("> td:first-child select").val()){alert(e.i18n.notReadyToSave+"\n• "+e.i18n.stillInserting);l.preventDefault(),l.stopImmediatePropagation();return false}if(j.find(".jsgrid-grid-body > table > tbody > tr.jsgrid-edit-row").length){alert(e.i18n.notReadyToSave+"\n• "+e.i18n.stillEditing);l.preventDefault(),l.stopImmediatePropagation();return false}j.find(".jsgrid-grid-body > table > tbody > tr:not(.jsgrid-nodata-row)").each(function(m){k.push(a.extend(a(this).data("JSGridItem"),{display_order:m}))});b.find(".-user-permissions").val(JSON.stringify(k))})})})(jQuery);